<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReWear - Profile</title>
  <!-- Add CSRF token meta tag before other resources -->
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{url_for('static', filename='css/navbar.css')}}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    /* Custom animations and additional styling */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }
    
    .profile-container {
      animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }
    .stat-card:nth-child(4) { animation-delay: 0.4s; }
    
    .tab-pane.active {
      animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Enhanced profile avatar styling */
    .profile-avatar {
      position: relative;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }
    
    .profile-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
    }
    
    .profile-avatar::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #667eea, #764ba2, #667eea);
      border-radius: 50%;
      z-index: -1;
      animation: rotate 3s linear infinite;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .profile-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #fff;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }
    
    .profile-icon {
      font-size: 2.5rem;
      color: #fff;
      font-weight: 300;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced username styling */
    .profile-username {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
      letter-spacing: -0.025em;
      position: relative;
    }
    
    /* Improved edit button */
    .edit-button {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      color: #374151;
      border: 2px solid rgba(102, 126, 234, 0.2);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .edit-button:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: #667eea;
      color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
    }
    
    /* Enhanced points bar with glassmorphism */
    .points-bar {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #1a202c;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .points-bar:hover {
      background: rgba(255, 255, 255, 0.35);
      border-color: rgba(255, 255, 255, 0.4);
    }
    
    .points-value {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
    }
    
    /* Enhanced refresh button */
    .refresh-btn {
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.2);
      color: #667eea;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin-left: 12px;
      backdrop-filter: blur(10px);
    }
    
    .refresh-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      border-color: #667eea;
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .refresh-btn .material-symbols-outlined {
      font-size: 18px;
    }
    
    /* Loading state */
    .refresh-btn.loading {
      animation: pulse 1s infinite;
    }
    
    /* Profile header background improvement */
    .profile-header {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    /* Tab styling improvements */
    .tab-button.active {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
      color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      border: 1px solid rgba(102, 126, 234, 0.3);
    }
    
    /* Improved scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
    }
    
    /* Enhanced form help text */
    .form-help {
      display: block;
      margin-top: 8px;
      font-size: 0.8rem;
      color: #64748b;
      font-style: italic;
      line-height: 1.4;
    }
    
    /* Section description improvements */
    .section-description {
      margin-bottom: 24px;
      color: #64748b;
      font-size: 1rem;
      line-height: 1.6;
      padding: 16px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }
    
    /* Enhanced Recent Activity Header */
    .activity-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #f1f5f9;
    }
    
    .activity-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    /* Enhanced Activity Item Structure */
    .activity-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      margin-bottom: 12px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .activity-item:hover {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }
    
    .activity-icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .activity-icon {
      color: #fff;
      font-size: 1.5rem;
      font-weight: 400;
    }
    
    .activity-content {
      flex-grow: 1;
      min-width: 0;
    }
    
    .activity-text {
      margin: 0 0 4px 0;
      font-weight: 600;
      color: #1a202c;
      font-size: 0.95rem;
      line-height: 1.4;
    }
    
    .activity-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 4px;
    }
    
    .activity-type {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .activity-status {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      width: 24px;
      height: 24px;
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      animation: statusPulse 2s ease-in-out infinite;
      box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
    }
    
    @keyframes statusPulse {
      0%, 100% { 
        opacity: 1; 
        transform: scale(1); 
      }
      50% { 
        opacity: 0.7; 
        transform: scale(1.2); 
      }
    }
    
    /* Enhanced Empty State */
    .empty-state-animation {
      position: relative;
      margin-bottom: 20px;
    }
    
    .empty-state-animation .material-symbols-outlined {
      animation: emptyStateFloat 3s ease-in-out infinite;
    }
    
    @keyframes emptyStateFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
    
    .empty-state-content h4 {
      color: #374151;
      font-weight: 700;
      margin: 0 0 8px 0;
      font-size: 1.25rem;
    }
    
    .empty-state-content p {
      color: #64748b;
      margin: 0;
      font-size: 1rem;
      line-height: 1.5;
    }
    
    /* Activity Item Animations */
    .activity-item {
      opacity: 0;
      transform: translateY(20px);
      animation: slideInActivity 0.5s ease-out forwards;
    }
    
    .activity-item:nth-child(1) { animation-delay: 0.1s; }
    .activity-item:nth-child(2) { animation-delay: 0.2s; }
    .activity-item:nth-child(3) { animation-delay: 0.3s; }
    .activity-item:nth-child(4) { animation-delay: 0.4s; }
    .activity-item:nth-child(5) { animation-delay: 0.5s; }
    
    @keyframes slideInActivity {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Enhanced Swap History Styling */
    .swaps-carousel-container {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(15px);
      border-radius: 24px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .swaps-carousel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      border-radius: 16px;
      border: 1px solid rgba(102, 126, 234, 0.2);
    }
    
    .swap-counter {
      font-weight: 600;
      color: #667eea;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .swap-counter::before {
      content: "📊";
      font-size: 1.2em;
    }
    
    .carousel-controls {
      display: flex;
      gap: 8px;
    }
    
    .carousel-btn {
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
      color: #667eea;
      border-radius: 12px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .carousel-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      border-color: #667eea;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .carousel-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .swap-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .swap-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .swap-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid rgba(102, 126, 234, 0.1);
    }
    
    .swap-id-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .swap-id {
      font-size: 1.25rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .swap-participants {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #64748b;
      font-weight: 500;
      font-size: 0.95rem;
    }
    
    .swap-participants .material-symbols-outlined {
      font-size: 1.2rem;
      color: #667eea;
    }
    
    .swap-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }
    
    .swap-date {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #64748b;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .swap-date .material-symbols-outlined {
      font-size: 1rem;
      color: #667eea;
    }
    
    .swap-status {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .swap-status.completed {
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    
    .swap-status .material-symbols-outlined {
      font-size: 1rem;
    }
    
    .swap-summary {
      margin-bottom: 24px;
      padding: 16px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }
    
    .swap-description {
      margin: 0;
      color: #374151;
      line-height: 1.6;
      font-size: 0.95rem;
    }
    
    .swap-items {
      margin-bottom: 24px;
    }
    
    .swap-item-pair {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 20px;
      align-items: center;
    }
    
    .swap-item {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .swap-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(102, 126, 234, 0.15);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .swap-item.my-item {
      border-left: 4px solid #667eea;
    }
    
    .swap-item.their-item {
      border-left: 4px solid #764ba2;
    }
    
    .swap-item-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .swap-item-header .material-symbols-outlined {
      font-size: 1.2rem;
      color: #667eea;
    }
    
    .swap-item-owner {
      font-weight: 600;
      color: #374151;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .swap-item-content {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    
    .swap-item-image {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.5);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
    }
    
    .swap-item-details {
      flex-grow: 1;
    }
    
    .swap-item-name {
      margin: 0 0 8px 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: #1a202c;
      line-height: 1.3;
    }
    
    .swap-item-category {
      margin: 0 0 8px 0;
      color: #64748b;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .swap-item-points {
      display: flex;
      align-items: center;
      gap: 4px;
      background: rgba(251, 191, 36, 0.1);
      color: #f59e0b;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      width: fit-content;
    }
    
    .swap-item-points .material-symbols-outlined {
      font-size: 1rem;
    }
    
    .swap-arrow-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .swap-arrow {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
      animation: swapPulse 2s ease-in-out infinite;
    }
    
    .swap-arrow .material-symbols-outlined {
      color: #fff;
      font-size: 1.5rem;
      font-weight: 500;
    }
    
    @keyframes swapPulse {
      0%, 100% { 
        transform: scale(1); 
      }
      50% { 
        transform: scale(1.05); 
      }
    }
    
    .swap-arrow-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: #667eea;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .swap-footer {
      border-top: 1px solid rgba(102, 126, 234, 0.1);
      padding-top: 16px;
    }
    
    .swap-completion-info {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .completion-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
      padding: 12px 20px;
      border-radius: 16px;
      font-weight: 600;
      font-size: 0.9rem;
      border: 1px solid rgba(16, 185, 129, 0.3);
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
    }
    
    .completion-badge .material-symbols-outlined {
      font-size: 1.2rem;
    }
    
    /* Carousel Indicators */
    .carousel-indicators {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
      padding: 16px;
    }
    
    .indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid rgba(102, 126, 234, 0.3);
      background: transparent;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .indicator.active {
      background: #667eea;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
    }
    
    .indicator:hover {
      border-color: #667eea;
      transform: scale(1.2);
    }
    
    /* Enhanced Empty State for Swap History */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .empty-state .material-symbols-outlined {
      font-size: 4rem;
      color: #667eea;
      margin-bottom: 20px;
      opacity: 0.7;
      animation: emptyStateFloat 3s ease-in-out infinite;
    }
    
    .empty-state p {
      color: #64748b;
      font-size: 1.1rem;
      margin: 0 0 24px 0;
      line-height: 1.6;
    }
    
    .create-request-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      display: inline-block;
    }
    
    .create-request-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    /* Responsive Design for Swap History */
    @media (max-width: 768px) {
      .swap-item-pair {
        grid-template-columns: 1fr;
        gap: 16px;
        text-align: center;
      }
      
      .swap-arrow-container {
        order: 2;
        transform: rotate(90deg);
      }
      
      .swap-item.their-item {
        order: 3;
      }
      
      .swap-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .swap-meta {
        align-items: flex-start;
      }
      
      .swap-actions {
        flex-direction: column;
      }
      
      .action-btn {
        justify-content: center;
      }
      
      .carousel-controls {
        order: -1;
      }
      
      .swaps-carousel-header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }
    }
    
    /* Enhanced Add Item Form Styling */
    .add-item-container {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 32px;
      margin-top: 24px;
    }
    
    .add-item-form {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }
    
    .form-row:has(.form-group:only-child) {
      grid-template-columns: 1fr;
    }
    
    .form-group {
      position: relative;
    }
    
    .form-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .form-group label .material-symbols-outlined {
      font-size: 1.2rem;
      color: #667eea;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-sizing: border-box;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      background: rgba(255, 255, 255, 0.9);
    }
    
    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: #94a3b8;
    }
    
    .char-counter {
      text-align: right;
      font-size: 0.8rem;
      color: #64748b;
      margin-top: 4px;
    }
    
    .image-upload-group {
      grid-column: 1 / -1;
    }
    
    .image-input-wrapper {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }
    
    .image-input-wrapper input {
      flex: 1;
    }
    
    .preview-btn {
      background: rgba(102, 126, 234, 0.1);
      border: 2px solid rgba(102, 126, 234, 0.3);
      color: #667eea;
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .preview-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .form-actions {
      display: flex;
      gap: 16px;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .save-button,
    .cancel-button {
      flex: 1;
      padding: 16px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      border: none;
    }
    
    .save-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
    }
    
    .save-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .cancel-button {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
      border: 2px solid rgba(239, 68, 68, 0.3);
    }
    
    .cancel-button:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: #dc2626;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }
    
    /* Image Preview Section */
    .image-preview-section {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      height: fit-content;
      position: sticky;
      top: 24px;
    }
    
    .preview-header {
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .preview-header h4 {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #374151;
      font-weight: 700;
    }
    
    .preview-header .material-symbols-outlined {
      color: #667eea;
      font-size: 1.3rem;
    }
    
    .preview-card {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .preview-image-container {
      position: relative;
      margin-bottom: 16px;
      border-radius: 12px;
      overflow: hidden;
      aspect-ratio: 1;
    }
    
    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .image-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .preview-image-container:hover .image-overlay {
      opacity: 1;
    }
    
    .image-overlay .material-symbols-outlined {
      font-size: 3rem;
      margin-bottom: 8px;
      opacity: 0.8;
    }
    
    .image-overlay p {
      margin: 0;
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    .preview-details h5 {
      margin: 0 0 8px 0;
      font-size: 1.2rem;
      font-weight: 700;
      color: #1a202c;
    }
    
    .preview-details p {
      margin: 0 0 16px 0;
      color: #64748b;
      font-size: 0.9rem;
      line-height: 1.5;
    }
    
    .preview-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .preview-points {
      display: flex;
      align-items: center;
      gap: 4px;
      background: rgba(251, 191, 36, 0.1);
      color: #f59e0b;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .preview-points .material-symbols-outlined {
      font-size: 1rem;
    }
    
    .preview-category {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .preview-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .tag {
      background: rgba(107, 114, 128, 0.1);
      color: #374151;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    /* Responsive Design for Add Item Form */
    @media (max-width: 1024px) {
      .add-item-container {
        grid-template-columns: 1fr;
        gap: 24px;
      }
      
      .image-preview-section {
        position: static;
      }
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .image-input-wrapper {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }
      
      .add-item-form {
        padding: 24px 20px;
      }
      
      .image-preview-section {
        padding: 20px;
      }
    }
    
    /* Notification animations */
    @keyframes slideInNotification {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutNotification {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
  </style>
</head>

<body>
  {% include 'navbar.html' %}
  
  <div class="profile-container">
    <!-- Profile Header with Points -->
    <div class="profile-header">
      <div class="profile-hero">
        <div class="profile-avatar">
          {% if current_user.profile_picture %}
            <img src="{{ current_user.profile_picture }}" alt="{{ current_user.username }}" class="profile-photo">
          {% else %}
            <span class="material-symbols-outlined profile-icon">person</span>
          {% endif %}
        </div>
        <div class="profile-main-info">
          <div class="profile-header-row">
            <h2 class="profile-username">{{ current_user.username }}</h2>
            <button class="edit-button" id="edit-profile-btn">
              <span class="material-symbols-outlined">edit</span> Edit Profile
            </button>
          </div>
          <div class="points-bar">
            <span class="points-label">Points:</span>
            <span class="points-value" id="points-display">{{ current_user.points_balance }}</span>
            <span class="points-icon">🪙</span>
            <button id="refresh-points-btn" class="refresh-btn" onclick="refreshPoints()" title="Refresh Points">
              <span class="material-symbols-outlined">refresh</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="profile-tabs">
      <div class="tab-header">
        <button class="tab-button active" data-tab="dashboard">
          <span class="material-symbols-outlined">dashboard</span>
          Dashboard
        </button>
        <button class="tab-button" data-tab="swap-requests">
          <span class="material-symbols-outlined">swap_horiz</span>
          Swap History
        </button>
        <button class="tab-button" data-tab="add-item">
          <span class="material-symbols-outlined">add_circle</span>
          List Items
        </button>
        <button class="tab-button" data-tab="my-redemptions">
          <span class="material-symbols-outlined">stars</span>
          My Redemptions
        </button>
        <button class="tab-button" data-tab="personal-info">
          <span class="material-symbols-outlined">person</span>
          Personal Info
        </button>
      </div>

      <div class="tab-content">
        <!-- Dashboard Tab -->
        <div class="tab-pane active" id="dashboard">
          <div class="detail-section">
            <h3>Dashboard Overview</h3>
            <div class="dashboard-stats">
              <div class="stat-card">
                <span class="material-symbols-outlined">inventory_2</span>
                <div class="stat-content">
                  <h4>{{ uploaded_products|length if uploaded_products else 0 }}</h4>
                  <p>Items Listed</p>
                </div>
              </div>
              <div class="stat-card">
                <span class="material-symbols-outlined">favorite</span>
                <div class="stat-content">
                  <h4>{{ wishlist_items|length if wishlist_items else 0 }}</h4>
                  <p>Wishlist Items</p>
                </div>
              </div>

              <div class="stat-card">
                <span class="material-symbols-outlined">swap_horiz</span>
                <div class="stat-content">
                  <h4>{{ user_swaps|length if user_swaps else 0 }}</h4>
                  <p>Completed Swaps</p>
                </div>
              </div>
              
              <div class="stat-card">
                <span class="material-symbols-outlined">stars</span>
                <div class="stat-content">
                  <h4>{{ point_redemptions|length if point_redemptions else 0 }}</h4>
                  <p>Point Redemptions</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="detail-section">
            <div class="activity-header">
              <h3>Recent Activity</h3>
              <span class="activity-badge">{{ recent_activity|length if recent_activity else 0 }} activities</span>
            </div>
            <div class="activity-list">
              {% if recent_activity %}
                {% for activity in recent_activity %}
                <div class="activity-item" data-activity-index="{{ loop.index0 }}">
                  <div class="activity-icon-wrapper">
                    <span class="activity-icon material-symbols-outlined">{{ activity.icon }}</span>
                  </div>
                  <div class="activity-content">
                    <p class="activity-text">{{ activity.text }}</p>
                    <div class="activity-meta">
                      <span class="activity-time">{{ activity.time }}</span>
                      <span class="activity-type">
                        {% if activity.icon == 'swap_horiz' %}
                          Swap
                        {% elif activity.icon == 'stars' %}
                          Redemption
                        {% elif activity.icon == 'add_circle' %}
                          Listing
                        {% else %}
                          Activity
                        {% endif %}
                      </span>
                    </div>
                  </div>
                  <div class="activity-status">
                    <span class="status-indicator"></span>
                  </div>
                </div>
                {% endfor %}
              {% else %}
                <div class="empty-state">
                  <div class="empty-state-animation">
                    <span class="material-symbols-outlined">timeline</span>
                  </div>
                  <div class="empty-state-content">
                    <h4>No recent activity</h4>
                    <p>Start by listing items or making swaps to see your activity here.</p>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Swap Requests Tab -->
        <div class="tab-pane" id="swap-requests">
          <div class="detail-section">
            <div class="activity-header">
              <h3>My Swap History</h3>
              <span class="activity-badge">Exchange Records</span>
            </div>
            {% if user_swaps and user_swaps|length > 0 %}
              <div class="swaps-carousel-container">
                <div class="swaps-carousel-header">
                  <div class="swap-counter">
                    <span id="current-swap-index">1</span> of {{ user_swaps|length }} swaps
                  </div>
                  <div class="carousel-controls">
                    <button class="carousel-btn prev" id="prev-swap" onclick="previousSwap()">
                      <span class="material-symbols-outlined">chevron_left</span>
                    </button>
                    <button class="carousel-btn next" id="next-swap" onclick="nextSwap()">
                      <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                  </div>
                </div>
                
                <div class="swaps-carousel">
                  {% for swap in user_swaps %}
                <div class="swap-card" data-swap-index="{{ loop.index0 }}" {% if loop.index0 == 0 %}style="display: block;"{% else %}style="display: none;"{% endif %}>
                  <div class="swap-header">
                    <div class="swap-id-section">
                      <span class="swap-id">Swap #{{ swap.id }}</span>
                      <span class="swap-participants">
                        <span class="material-symbols-outlined">people</span>
                        {{ swap.user1.username }} ⇄ {{ swap.user2.username }}
                      </span>
                    </div>
                    <div class="swap-meta">
                      <span class="swap-date">
                        <span class="material-symbols-outlined">calendar_today</span>
                        {{ swap.completed_at.strftime('%B %d, %Y') }}
                      </span>
                      <span class="swap-status completed">
                        <span class="material-symbols-outlined">check_circle</span>
                        Completed
                      </span>
                    </div>
                  </div>
                  
                  <div class="swap-summary">
                    <p class="swap-description">
                      Successfully exchanged clothing items between 
                      <strong>{{ swap.user1.username }}</strong> and <strong>{{ swap.user2.username }}</strong>
                    </p>
                  </div>

                  <div class="swap-items">
                    {% if swap.user1_id == current_user.id %}
                      <div class="swap-item-pair">
                        <div class="swap-item my-item">
                          <div class="swap-item-header">
                            <span class="material-symbols-outlined">person</span>
                            <span class="swap-item-owner">Your Item</span>
                          </div>
                          <div class="swap-item-content">
                            <img src="{{ swap.item1.image_url }}" alt="{{ swap.item1.name }}" class="swap-item-image">
                            <div class="swap-item-details">
                              <h4 class="swap-item-name">{{ swap.item1.name }}</h4>
                              <p class="swap-item-category">{{ swap.item1.category.name if swap.item1.category else 'Clothing' }}</p>
                              {% if swap.item1.points_required %}
                              <span class="swap-item-points">
                                <span class="material-symbols-outlined">stars</span>
                                {{ swap.item1.points_required }} points value
                              </span>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                        
                        <div class="swap-arrow-container">
                          <div class="swap-arrow">
                            <span class="material-symbols-outlined">swap_horiz</span>
                          </div>
                          <span class="swap-arrow-label">Exchanged</span>
                        </div>
                        
                        <div class="swap-item their-item">
                          <div class="swap-item-header">
                            <span class="material-symbols-outlined">person_outline</span>
                            <span class="swap-item-owner">{{ swap.user2.username }}'s Item</span>
                          </div>
                          <div class="swap-item-content">
                            <img src="{{ swap.item2.image_url }}" alt="{{ swap.item2.name }}" class="swap-item-image">
                            <div class="swap-item-details">
                              <h4 class="swap-item-name">{{ swap.item2.name }}</h4>
                              <p class="swap-item-category">{{ swap.item2.category.name if swap.item2.category else 'Clothing' }}</p>
                              {% if swap.item2.points_required %}
                              <span class="swap-item-points">
                                <span class="material-symbols-outlined">stars</span>
                                {{ swap.item2.points_required }} points value
                              </span>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                    {% else %}
                      <div class="swap-item-pair">
                        <div class="swap-item my-item">
                          <div class="swap-item-header">
                            <span class="material-symbols-outlined">person</span>
                            <span class="swap-item-owner">Your Item</span>
                          </div>
                          <div class="swap-item-content">
                            <img src="{{ swap.item2.image_url }}" alt="{{ swap.item2.name }}" class="swap-item-image">
                            <div class="swap-item-details">
                              <h4 class="swap-item-name">{{ swap.item2.name }}</h4>
                              <p class="swap-item-category">{{ swap.item2.category.name if swap.item2.category else 'Clothing' }}</p>
                              {% if swap.item2.points_required %}
                              <span class="swap-item-points">
                                <span class="material-symbols-outlined">stars</span>
                                {{ swap.item2.points_required }} points value
                              </span>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                        
                        <div class="swap-arrow-container">
                          <div class="swap-arrow">
                            <span class="material-symbols-outlined">swap_horiz</span>
                          </div>
                          <span class="swap-arrow-label">Exchanged</span>
                        </div>
                        
                        <div class="swap-item their-item">
                          <div class="swap-item-header">
                            <span class="material-symbols-outlined">person_outline</span>
                            <span class="swap-item-owner">{{ swap.user1.username }}'s Item</span>
                          </div>
                          <div class="swap-item-content">
                            <img src="{{ swap.item1.image_url }}" alt="{{ swap.item1.name }}" class="swap-item-image">
                            <div class="swap-item-details">
                              <h4 class="swap-item-name">{{ swap.item1.name }}</h4>
                              <p class="swap-item-category">{{ swap.item1.category.name if swap.item1.category else 'Clothing' }}</p>
                              {% if swap.item1.points_required %}
                              <span class="swap-item-points">
                                <span class="material-symbols-outlined">stars</span>
                                {{ swap.item1.points_required }} points value
                              </span>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                    {% endif %}
                  </div>
                  
                  <div class="swap-footer">
                    <div class="swap-completion-info">
                      <span class="completion-badge">
                        <span class="material-symbols-outlined">verified</span>
                        Exchange Completed Successfully
                      </span>
                    </div>
                  </div>
                </div>
                {% endfor %}
                </div>
                
                <!-- Carousel Indicators -->
                <div class="carousel-indicators">
                  {% for swap in user_swaps %}
                  <button class="indicator {% if loop.index0 == 0 %}active{% endif %}" 
                          onclick="goToSwap({{ loop.index0 }})" 
                          data-swap-target="{{ loop.index0 }}">
                  </button>
                  {% endfor %}
                </div>
              </div>
            {% else %}
              <div class="empty-state">
                <span class="material-symbols-outlined">swap_horiz</span>
                <p>You haven't completed any swaps yet.</p>
                <button class="create-request-btn" onclick="showCreateRequestForm()">Add Item to Swap</button>
              </div>
            {% endif %}
          </div>
          
          <!-- Point Redemptions Section -->
          <div class="detail-section">
            <h3>Point Redemptions</h3>
            {% if point_redemptions and point_redemptions|length > 0 %}
              <div class="redemptions-list">
                {% for redemption in point_redemptions %}
                <div class="redemption-card">
                  <div class="redemption-header">
                    <span class="redemption-date">{{ redemption.redeemed_at.strftime('%B %d, %Y') }}</span>
                    <span class="points-spent">{{ redemption.points_spent }} points</span>
                  </div>
                  <div class="redemption-item">
                    <img src="{{ redemption.product.image_url }}" alt="{{ redemption.product.name }}" class="redemption-item-image">
                    <div class="redemption-item-details">
                      <p class="redemption-item-name">{{ redemption.product.name }}</p>
                      <p class="redemption-item-category">{{ redemption.product.category.name }}</p>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="empty-state">
                <span class="material-symbols-outlined">stars</span>
                <p>You haven't redeemed any points yet.</p>
                <a href="{{ url_for('main.home') }}" class="shop-now-btn">Browse Items</a>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Add Item Tab -->
        <div class="tab-pane" id="add-item">
          <div class="detail-section">
            <div class="activity-header">
              <h3>Add New Item to ReWear</h3>
              <span class="activity-badge">List Item</span>
            </div>
            <p class="section-description">Add clothing items you want to exchange or sell for points on the ReWear platform.</p>
            
            <div class="add-item-container">
              <div class="add-item-form">
                <form id="add-item-form">
                  <!-- Item Name -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="item-name">
                        <span class="material-symbols-outlined">label</span>
                        Item Name
                      </label>
                      <input type="text" id="item-name" name="name" placeholder="e.g., Vintage Denim Jacket" required>
                    </div>
                  </div>
                  
                  <!-- Description -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="item-description">
                        <span class="material-symbols-outlined">description</span>
                        Description
                      </label>
                      <textarea id="item-description" name="description" rows="4" placeholder="Describe the item condition, size, brand, and any other relevant details..." required></textarea>
                      <div class="char-counter">
                        <span id="desc-count">0</span>/500 characters
                      </div>
                    </div>
                  </div>
                  
                  <!-- Points and Category Row -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="item-points">
                        <span class="material-symbols-outlined">stars</span>
                        Points Required
                      </label>
                      <input type="number" id="item-points" name="points" min="1" max="100" placeholder="10" required>
                      <small class="form-help">Consider the item's condition, brand, and desirability when setting points.</small>
                    </div>
                    <div class="form-group">
                      <label for="item-category">
                        <span class="material-symbols-outlined">category</span>
                        Category
                      </label>
                      <select id="item-category" name="category_id" required>
                        <option value="">Select Category</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  
                  <!-- Size and Condition Row -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="item-size">
                        <span class="material-symbols-outlined">straighten</span>
                        Size
                      </label>
                      <select id="item-size" name="size">
                        <option value="">Select Size</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                        <option value="One Size">One Size</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="item-condition">
                        <span class="material-symbols-outlined">verified</span>
                        Condition
                      </label>
                      <select id="item-condition" name="condition" required>
                        <option value="">Select Condition</option>
                        <option value="New">New with Tags</option>
                        <option value="Like New">Like New</option>
                        <option value="Good">Good</option>
                        <option value="Fair">Fair</option>
                        <option value="Poor">Poor</option>
                      </select>
                    </div>
                  </div>
                  
                  <!-- Image Upload Section -->
                  <div class="form-row">
                    <div class="form-group image-upload-group">
                      <label for="item-image">
                        <span class="material-symbols-outlined">image</span>
                        Item Image
                      </label>
                      <div class="image-upload-container">
                        <div class="image-input-wrapper">
                          <input type="url" id="item-image" name="image_url" placeholder="https://example.com/image.jpg">
                          <button type="button" class="preview-btn" onclick="previewImage()">
                            <span class="material-symbols-outlined">visibility</span>
                            Preview
                          </button>
                        </div>
                        <small class="form-help">Add a clear photo showing the item's condition and details.</small>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Form Actions -->
                  <div class="form-actions">
                    <button type="submit" class="save-button">
                      <span class="material-symbols-outlined">add_circle</span>
                      Add Item to ReWear
                    </button>
                    <button type="reset" class="cancel-button">
                      <span class="material-symbols-outlined">refresh</span>
                      Clear Form
                    </button>
                  </div>
                </form>
              </div>
              
              <!-- Image Preview Section -->
              <div class="image-preview-section">
                <div class="preview-header">
                  <h4>
                    <span class="material-symbols-outlined">preview</span>
                    Item Preview
                  </h4>
                </div>
                <div class="preview-card">
                  <div class="preview-image-container">
                    <img id="preview-image" src="https://placehold.co/300x300/e2e8f0/64748b?text=No+Image" alt="Item Preview" class="preview-image">
                    <div class="image-overlay">
                      <span class="material-symbols-outlined">add_photo_alternate</span>
                      <p>Add image URL to see preview</p>
                    </div>
                  </div>
                  <div class="preview-details">
                    <h5 id="preview-name">Item Name</h5>
                    <p id="preview-description">Item description will appear here...</p>
                    <div class="preview-meta">
                      <span class="preview-points" id="preview-points">
                        <span class="material-symbols-outlined">stars</span>
                        0 points
                      </span>
                      <span class="preview-category" id="preview-category">Category</span>
                    </div>
                    <div class="preview-tags">
                      <span class="tag" id="preview-size-tag" style="display: none;">Size: <span id="preview-size"></span></span>
                      <span class="tag" id="preview-condition-tag" style="display: none;">Condition: <span id="preview-condition"></span></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- My Uploaded Items Section -->
          <div class="detail-section">
            <div class="listed-items-header">
              <div class="header-content">
                <h3>
                  <span class="material-symbols-outlined">inventory_2</span>
                  My Listed Items
                </h3>
                <p class="section-description">Manage your clothing items listed for exchange on ReWear</p>
              </div>
              <div class="header-stats">
                <div class="stat-pill">
                  <span class="material-symbols-outlined">inventory</span>
                  <span>{{ uploaded_products|length if uploaded_products else 0 }} Items</span>
                </div>
                <div class="stat-pill">
                  <span class="material-symbols-outlined">check_circle</span>
                  <span>{{ uploaded_products|selectattr('approval_status', 'equalto', 'approved')|list|length if uploaded_products else 0 }} Approved</span>
                </div>
              </div>
              {% if uploaded_products and uploaded_products|length > 0 %}
              <div class="items-controls">
                <div class="filter-controls">
                  <select id="status-filter" class="status-filter">
                    <option value="all">All Items</option>
                    <option value="approved">Approved</option>
                    <option value="pending">Pending</option>
                    <option value="rejected">Rejected</option>
                  </select>
                  <select id="sort-filter" class="sort-filter">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="points-high">Points: High to Low</option>
                    <option value="points-low">Points: Low to High</option>
                  </select>
                </div>
                <div class="view-toggle">
                  <button class="view-btn active" data-view="grid" title="Grid View">
                    <span class="material-symbols-outlined">grid_view</span>
                  </button>
                  <button class="view-btn" data-view="list" title="List View">
                    <span class="material-symbols-outlined">view_list</span>
                  </button>
                </div>
              </div>
              {% endif %}
            </div>
            
            {% if uploaded_products and uploaded_products|length > 0 %}
              <div class="uploaded-items-container" id="items-container">
                <div class="uploaded-items-list" id="items-list">
                  {% for product in uploaded_products %}
                  <div class="uploaded-item-card" data-status="{{ product.approval_status }}" data-points="{{ product.points_required }}" data-date="{{ product.created_at }}">
                    <div class="item-image-container">
                      <img src="{{ product.image_url }}" alt="{{ product.name }}" class="uploaded-item-image">
                      <div class="item-overlay">
                        <button class="quick-view-btn" data-product-id="{{ product.id }}" title="Quick View">
                          <span class="material-symbols-outlined">visibility</span>
                        </button>
                      </div>
                      <div class="approval-badge {{ product.approval_status }}">
                        {% if product.approval_status == 'approved' %}
                          <span class="material-symbols-outlined">verified</span>
                        {% elif product.approval_status == 'pending' %}
                          <span class="material-symbols-outlined">pending</span>
                        {% elif product.approval_status == 'rejected' %}
                          <span class="material-symbols-outlined">cancel</span>
                        {% endif %}
                      </div>
                    </div>
                    
                    <div class="uploaded-item-content">
                      <div class="item-header">
                        <h4 class="uploaded-item-name">{{ product.name }}</h4>
                        <button class="favorite-btn" data-product-id="{{ product.id }}" title="Add to favorites">
                          <span class="material-symbols-outlined">favorite_border</span>
                        </button>
                      </div>
                      
                      <div class="item-details">
                        <p class="uploaded-item-category">{{ product.category.name }}</p>
                        {% if product.size %}
                        <span class="item-size">Size {{ product.size }}</span>
                        {% endif %}
                        {% if product.condition %}
                        <span class="item-condition">{{ product.condition }}</span>
                        {% endif %}
                      </div>
                      
                      <div class="item-stats">
                        <div class="stat-group">
                          <div class="uploaded-item-points">
                            <span class="material-symbols-outlined">stars</span>
                            {{ product.points_required }} points
                          </div>
                          <div class="uploaded-item-stock">
                            <span class="material-symbols-outlined">inventory</span>
                            {{ product.stock }} available
                          </div>
                        </div>
                        
                        <div class="item-views">
                          <span class="material-symbols-outlined">visibility</span>
                          <span>{{ product.view_count or 0 }} views</span>
                        </div>
                      </div>
                      
                      <div class="approval-status-detail {{ product.approval_status }}">
                        {% if product.approval_status == 'approved' %}
                          <span class="status-icon">✅</span>
                          <span class="status-text">Approved & Live</span>
                        {% elif product.approval_status == 'pending' %}
                          <span class="status-icon">⏳</span>
                          <span class="status-text">Pending Review</span>
                        {% elif product.approval_status == 'rejected' %}
                          <span class="status-icon">❌</span>
                          <span class="status-text">Rejected</span>
                        {% endif %}
                        <span class="status-date">{{ product.created_at.strftime('%b %d') }}</span>
                      </div>
                      
                      {% if product.approval_status == 'rejected' and product.rejection_reason %}
                        <div class="rejection-reason">
                          <span class="material-symbols-outlined">info</span>
                          <p>{{ product.rejection_reason }}</p>
                        </div>
                      {% endif %}
                      
                      <div class="uploaded-item-actions">
                        <button class="edit-item-btn primary" data-product-id="{{ product.id }}" title="Edit Item">
                          <span class="material-symbols-outlined">edit</span>
                          <span class="btn-text">Edit</span>
                        </button>
                        <button class="duplicate-item-btn secondary" data-product-id="{{ product.id }}" title="Duplicate Item">
                          <span class="material-symbols-outlined">content_copy</span>
                          <span class="btn-text">Copy</span>
                        </button>
                        <button class="remove-item-btn danger" data-product-id="{{ product.id }}" title="Remove Item">
                          <span class="material-symbols-outlined">delete</span>
                          <span class="btn-text">Remove</span>
                        </button>
                      </div>
                    </div>
                    
                    <!-- Performance Indicator -->
                    <div class="performance-indicator">
                      <div class="performance-bar">
                        <div class="performance-fill" style="width: {{ (product.view_count or 0) * 10 if (product.view_count or 0) < 10 else 100 }}%"></div>
                      </div>
                      <span class="performance-label">Performance</span>
                    </div>
                  </div>
                  {% endfor %}
                </div>
                
                <!-- Loading State -->
                <div class="loading-state" id="loading-state" style="display: none;">
                  <div class="loading-spinner"></div>
                  <p>Loading items...</p>
                </div>
              </div>
            {% else %}
              <div class="empty-state enhanced">
                <div class="empty-animation">
                  <div class="floating-icon">
                    <span class="material-symbols-outlined">inventory_2</span>
                  </div>
                  <div class="floating-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                  </div>
                </div>
                <div class="empty-content">
                  <h4>No Items Listed Yet</h4>
                  <p>Start building your ReWear inventory by listing clothing items you want to exchange or sell for points.</p>
                  <div class="empty-actions">
                    <button class="add-first-item-btn" onclick="switchTab('add-item')">
                      <span class="material-symbols-outlined">add_circle</span>
                      List Your First Item
                    </button>
                    <button class="learn-more-btn" onclick="showListingTips()">
                      <span class="material-symbols-outlined">lightbulb</span>
                      Listing Tips
                    </button>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- My Redemptions Tab -->
        <div class="tab-pane" id="my-redemptions">
          <div class="detail-section">
            <h3>Point Redemptions History</h3>
            <p class="section-description">Track all your point redemptions and claimed items from the ReWear platform.</p>
            {% if point_redemptions and point_redemptions|length > 0 %}
              <div class="redemptions-list">
                {% for redemption in point_redemptions %}
                <div class="redemption-card">
                  <div class="redemption-header">
                    <span class="redemption-id">Redemption #{{ redemption.id }}</span>
                    <span class="redemption-date">{{ redemption.redeemed_at.strftime('%B %d, %Y') }}</span>
                    <span class="points-spent">{{ redemption.points_spent }} points</span>
                  </div>
                  <div class="redemption-item">
                    <img src="{{ redemption.product.image_url }}" alt="{{ redemption.product.name }}" class="redemption-item-image">
                    <div class="redemption-item-details">
                      <p class="redemption-item-name">{{ redemption.product.name }}</p>
                      <p class="redemption-item-category">{{ redemption.product.category.name }}</p>
                      <div class="redemption-meta">
                        <span class="redemption-status">✅ Claimed</span>
                        <span class="redemption-value">Worth {{ redemption.points_spent }} points</span>
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
              
              <!-- Summary Stats -->
              <div class="redemption-summary">
                <h4>Redemption Summary</h4>
                <div class="summary-stats">
                  <div class="summary-stat">
                    <span class="stat-label">Total Redemptions:</span>
                    <span class="stat-value">{{ point_redemptions|length }}</span>
                  </div>
                  <div class="summary-stat">
                    <span class="stat-label">Total Points Spent:</span>
                    <span class="stat-value">{{ point_redemptions|sum(attribute='points_spent') }} points</span>
                  </div>
                </div>
              </div>
            {% else %}
              <div class="empty-state">
                <span class="material-symbols-outlined">stars</span>
                <p>You haven't redeemed any points yet.</p>
                <p>Start earning points through swaps and redeem them for amazing clothing items!</p>
                <a href="{{ url_for('main.home') }}" class="shop-now-btn">Browse Items to Redeem</a>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Personal Info Tab (includes addresses) -->
        <div class="tab-pane" id="personal-info">
          <div class="detail-section">
            <h3>Personal Information</h3>
            <div id="personal-info-display">
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">Username</span>
                  <span class="info-value">{{ current_user.username }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Email</span>
                  <span class="info-value">{{ current_user.email }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Phone</span>
                  <span class="info-value">{{ current_user.phone or 'Not set' }}</span>
                </div>
              </div>
            </div>
            
            <form id="personal-info-form" style="display: none;">
              <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" value="{{ current_user.username }}" required>
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" value="{{ current_user.email }}" required>
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" id="phone" name="phone" value="{{ current_user.phone or '' }}">
              </div>
              <div class="form-actions">
                <button type="submit" class="save-button">Save Changes</button>
                <button type="button" class="cancel-button" id="cancel-edit-btn">Cancel</button>
              </div>
            </form>
            <div id="flash-messages"></div>
          </div>

          <!-- Addresses Section -->
          <div class="detail-section">
            <h3>Your Addresses</h3>
            {% if addresses and addresses|length > 0 %}
              <div class="addresses-grid">
                {% for address in addresses %}
                <div class="address-card {% if address.is_default %}default{% endif %}">
                  {% if address.is_default %}
                  <span class="default-badge">Default</span>
                  {% endif %}
                  <h4>{{ address.address_type|title }}</h4>
                  <p>{{ current_user.username }}</p>
                  {% if address.company_name %}
                  <p>{{ address.company_name }}</p>
                  {% endif %}
                  <p>{{ address.street_address }}</p>
                  {% if address.apartment %}
                  <p>{{ address.apartment }}</p>
                  {% endif %}
                  <p>{{ address.city }}, {{ address.state }}, {{ address.pin_code }}</p>
                  <p>{{ address.country }}</p>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="empty-state">
                <span class="material-symbols-outlined">home</span>
                <p>You haven't added any addresses yet.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {% include 'footer.html' %}

  <nav class="mobile-bottom-nav">
    <a href="{{ url_for('main.home') }}" class="{% if request.endpoint == 'main.home' %}active{% endif %}">
      <span class="material-symbols-outlined">home</span>
      <span>Home</span>
    </a>
    <a href="{{ url_for('main.search') }}" class="{% if request.endpoint == 'main.search' %}active{% endif %}">
      <span class="material-symbols-outlined">search</span>
      <span>Search</span>
    </a>
    <a href="{{ url_for('main.wishlist') }}" class="{% if request.endpoint == 'main.wishlist' %}active{% endif %}">
      <span class="material-symbols-outlined">favorite</span>
      <span>Wishlist</span>
    </a>
    {% if current_user.is_authenticated %}
      <a href="{{ url_for('main.profile') }}" class="{% if request.endpoint == 'main.profile' %}active{% endif %}">
        <span class="material-symbols-outlined">person</span>
        <span>Profile</span>
      </a>
    {% else %}
      <a href="{{ url_for('main.signin') }}" class="{% if request.endpoint == 'main.signin' %}active{% endif %}">
        <span class="material-symbols-outlined">login</span>
        <span>Login</span>
      </a>
    {% endif %}
  </nav>

  <script src="https://kit.fontawesome.com/51c1e7b4cb.js" crossorigin="anonymous"></script>
  <!-- Load the external JavaScript file -->
  <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
  
  <script>
    // Tab functionality
    document.addEventListener('DOMContentLoaded', function() {
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabPanes = document.querySelectorAll('.tab-pane');

      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all buttons and panes
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabPanes.forEach(pane => pane.classList.remove('active'));

          // Add active class to clicked button
          this.classList.add('active');

          // Show the corresponding tab pane
          const tabId = this.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
        });
      });
    });

    function showCreateRequestForm() {
      // Switch to Add Item tab
      document.querySelector('[data-tab="add-item"]').click();
    }

    // Function to refresh points balance
    function refreshPoints() {
      const refreshBtn = document.getElementById('refresh-points-btn');
      const pointsDisplay = document.getElementById('points-display');
      
      // Add loading state
      refreshBtn.style.animation = 'spin 1s linear infinite';
      
      fetch('/refresh-points')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            pointsDisplay.textContent = data.points_balance;
            // Show success indicator
            pointsDisplay.style.color = '#4caf50';
            setTimeout(() => {
              pointsDisplay.style.color = '';
            }, 2000);
          } else {
            console.error('Failed to refresh points:', data.message);
          }
        })
        .catch(error => {
          console.error('Error refreshing points:', error);
        })
        .finally(() => {
          // Remove loading state
          refreshBtn.style.animation = '';
        });
    }

    // CSS animation for spin
    const style = document.createElement('style');
    style.textContent = `
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `;
    document.head.appendChild(style);

    // Swap action functions
    function viewSwapDetails(swapId) {
      // Create a modal or detailed view for the swap
      alert(`Viewing details for Swap #${swapId}. This feature will show complete swap history, messaging, and transaction details.`);
      // TODO: Implement detailed swap view modal
    }

    function downloadSwapReceipt(swapId) {
      // Generate and download swap receipt
      alert(`Downloading receipt for Swap #${swapId}. This will generate a PDF receipt with swap details.`);
      // TODO: Implement receipt generation and download
    }

    // Carousel functionality for swaps
    let currentSwapIndex = 0;
    const totalSwaps = document.querySelectorAll('.swap-card').length;

    function updateSwapDisplay() {
      // Hide all swap cards
      document.querySelectorAll('.swap-card').forEach((card, index) => {
        card.style.display = index === currentSwapIndex ? 'block' : 'none';
      });

      // Update indicators
      document.querySelectorAll('.indicator').forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentSwapIndex);
      });

      // Update counter
      document.getElementById('current-swap-index').textContent = currentSwapIndex + 1;

      // Update button states
      document.getElementById('prev-swap').disabled = currentSwapIndex === 0;
      document.getElementById('next-swap').disabled = currentSwapIndex === totalSwaps - 1;
    }

    function nextSwap() {
      if (currentSwapIndex < totalSwaps - 1) {
        currentSwapIndex++;
        updateSwapDisplay();
      }
    }

    function previousSwap() {
      if (currentSwapIndex > 0) {
        currentSwapIndex--;
        updateSwapDisplay();
      }
    }

    function goToSwap(index) {
      currentSwapIndex = index;
      updateSwapDisplay();
    }

    // Initialize carousel on page load
    document.addEventListener('DOMContentLoaded', function() {
      if (totalSwaps > 0) {
        updateSwapDisplay();
        
        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
          // Only work if we're on the swap history tab
          const swapTab = document.getElementById('swap-requests');
          if (swapTab && swapTab.classList.contains('active')) {
            if (e.key === 'ArrowLeft') {
              e.preventDefault();
              previousSwap();
            } else if (e.key === 'ArrowRight') {
              e.preventDefault();
              nextSwap();
            }
          }
        });

        // Add touch/swipe support for mobile
        let startX = 0;
        let endX = 0;
        const carousel = document.querySelector('.swaps-carousel');
        
        if (carousel) {
          carousel.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
          });

          carousel.addEventListener('touchend', function(e) {
            endX = e.changedTouches[0].clientX;
            handleSwipe();
          });

          function handleSwipe() {
            const swipeThreshold = 50;
            const diff = startX - endX;
            
            if (Math.abs(diff) > swipeThreshold) {
              if (diff > 0) {
                // Swiped left, go to next
                nextSwap();
              } else {
                // Swiped right, go to previous
                previousSwap();
              }
            }
          }
        }
      }
    });

    // Enhanced Add Item Form Preview Functionality
    function initializeFormPreview() {
      const form = document.getElementById('add-item-form');
      if (!form) return;
      
      const itemName = document.getElementById('item-name');
      const itemDescription = document.getElementById('item-description');
      const itemPoints = document.getElementById('item-points');
      const itemCategory = document.getElementById('item-category');
      const itemSize = document.getElementById('item-size');
      const itemCondition = document.getElementById('item-condition');
      const itemImage = document.getElementById('item-image');
      
      // Preview elements
      const previewName = document.getElementById('preview-name');
      const previewDescription = document.getElementById('preview-description');
      const previewPoints = document.getElementById('preview-points');
      const previewCategory = document.getElementById('preview-category');
      const previewSize = document.getElementById('preview-size');
      const previewCondition = document.getElementById('preview-condition');
      const previewSizeTag = document.getElementById('preview-size-tag');
      const previewConditionTag = document.getElementById('preview-condition-tag');
      const previewImage = document.getElementById('preview-image');
      const descCount = document.getElementById('desc-count');
      
      // Real-time preview updates
      function updatePreview() {
        if (previewName) previewName.textContent = itemName.value || 'Item Name';
        
        const description = itemDescription.value || 'Item description will appear here...';
        if (previewDescription) previewDescription.textContent = description;
        if (descCount) {
          descCount.textContent = itemDescription.value.length;
          descCount.style.color = itemDescription.value.length > 450 ? '#dc2626' : '#64748b';
        }
        
        const points = itemPoints.value || '0';
        if (previewPoints) previewPoints.innerHTML = `<span class="material-symbols-outlined">stars</span>${points} points`;
        
        const categoryText = itemCategory.options[itemCategory.selectedIndex]?.text || 'Category';
        if (previewCategory) previewCategory.textContent = categoryText;
        
        if (itemSize && previewSizeTag && previewSize) {
          if (itemSize.value) {
            previewSize.textContent = itemSize.value;
            previewSizeTag.style.display = 'inline-block';
          } else {
            previewSizeTag.style.display = 'none';
          }
        }
        
        if (itemCondition && previewConditionTag && previewCondition) {
          if (itemCondition.value) {
            previewCondition.textContent = itemCondition.value;
            previewConditionTag.style.display = 'inline-block';
          } else {
            previewConditionTag.style.display = 'none';
          }
        }
      }
      
      // Add event listeners
      if (itemName) itemName.addEventListener('input', updatePreview);
      if (itemDescription) itemDescription.addEventListener('input', updatePreview);
      if (itemPoints) itemPoints.addEventListener('input', updatePreview);
      if (itemCategory) itemCategory.addEventListener('change', updatePreview);
      if (itemSize) itemSize.addEventListener('change', updatePreview);
      if (itemCondition) itemCondition.addEventListener('change', updatePreview);
      if (itemImage) itemImage.addEventListener('input', previewImage);
      
      form.addEventListener('reset', function() {
        setTimeout(() => {
          updatePreview();
          resetImagePreview();
        }, 10);
      });
      
      updatePreview();
    }
    
    // Image preview function
    function previewImage() {
      const imageUrl = document.getElementById('item-image')?.value;
      const previewImage = document.getElementById('preview-image');
      const imageOverlay = document.querySelector('.image-overlay');
      
      if (!imageUrl || !previewImage) return;
      
      if (imageUrl) {
        const tempImg = new Image();
        tempImg.onload = function() {
          previewImage.src = imageUrl;
          if (imageOverlay) imageOverlay.style.opacity = '0';
        };
        tempImg.onerror = function() {
          previewImage.src = 'https://placehold.co/300x300/ef4444/ffffff?text=Invalid+URL';
          if (imageOverlay) {
            imageOverlay.style.opacity = '0.8';
            imageOverlay.innerHTML = `
              <span class="material-symbols-outlined">error</span>
              <p>Invalid image URL</p>
            `;
          }
        };
        tempImg.src = imageUrl;
      } else {
        resetImagePreview();
      }
    }
    
    function resetImagePreview() {
      const previewImage = document.getElementById('preview-image');
      const imageOverlay = document.querySelector('.image-overlay');
      
      if (previewImage) previewImage.src = 'https://placehold.co/300x300/e2e8f0/64748b?text=No+Image';
      if (imageOverlay) {
        imageOverlay.style.opacity = '1';
        imageOverlay.innerHTML = `
          <span class="material-symbols-outlined">add_photo_alternate</span>
          <p>Add image URL to see preview</p>
        `;
      }
    }
    
    // Initialize form preview when tab becomes active
    document.addEventListener('DOMContentLoaded', function() {
      initializeFormPreview();
      
      // Re-initialize when add-item tab is clicked
      const addItemTab = document.querySelector('[data-tab="add-item"]');
      if (addItemTab) {
        addItemTab.addEventListener('click', function() {
          setTimeout(initializeFormPreview, 100);
        });
      }
    });
  </script>
</body>

</html>