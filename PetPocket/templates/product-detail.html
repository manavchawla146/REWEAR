<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{{ product.name }} - ReWear</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/product-detail.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/product-detail-related.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/product-detail-review.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Open+Sans:wght@400&display=swap" rel="stylesheet">
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
    rel="stylesheet"
/>
    <style>

        .product-info h1{
            font-weight: 500;
        }

         .product-meta {
            display: flex;
            align-items: center;
            gap: 10vh;
            margin-bottom: 15px;
        }

        .product-price{
            font-size: clamp(2.1rem, 2vw, 0.95rem);
            color: #ffca28;
        }

        .info {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2vh;
            margin-bottom: 4vh;
            
        }

        .delivery {
            border: 1px solid #ffca28;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.053);
            background: linear-gradient(145deg, #fff7e6, #fff); 
            gap: 1vh;
        }

        .delivery i {
           font-size: 24px;
            width: 35px;
            height: 35px;
            padding: 12px;
            background: linear-gradient(90deg, #ffca28, #ffb300);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delivery p {
            font-weight: 900;
        }


        .satisfaction {
            border: 1px solid #ffca28;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.053);
            background: linear-gradient(145deg, #fff7e6, #fff);
            gap: 1vh; 
        }

        .satisfaction i {
           font-size: 24px;
            width: 35px;
            height: 35px;
            padding: 12px;
            background: linear-gradient(90deg, #ffca28, #ffb300);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .satisfaction p {
            font-weight: 900;
        }


         .safe-payment {
            border: 1px solid #ffca28;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.053);
            background: linear-gradient(145deg, #fff7e6, #fff); 
            gap: 1vh;
        }

        .safe-payment i {
            font-size: 24px;
            width: 35px;
            height: 35px;
            padding: 12px;
            background: linear-gradient(90deg, #ffca28, #ffb300);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .safe-payment p {
            font-weight: 900;
        }

/*         
        .product-container {
    flex-direction: row;
    gap: 30px;
    padding: 30px;
    align-items: flex-start; 
    
} */

.product-image {
    flex: 1;
    order: 1;
    text-align: left;
    position: sticky;
    top: 20px; /* Stick to the top with a small offset */
    align-self: flex-start; /* Ensure it starts at the top */
    z-index: 10;
}



@media (max-width: 480px) {

            .info {
                gap: 10px;
                padding: 10px;
                display: flex;
                flex-wrap: wrap;
                flex: 1;
            }

            .delivery,
            .satisfaction,
            .safe-payment {
                flex: 1; /* Even smaller card width */
                padding: 12px;
                height: 100px;
            }

            .delivery i,
            .satisfaction i,
            .safe-payment i {
                font-size: 18px;
                width: 35px;
                height: 35px;
                padding: 8px;
            }

            .delivery p,
            .satisfaction p,
            .safe-payment p {
                font-size: 10px;
            }
        

    
        .product-image {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
            justify-content: center;
            overflow: hidden;
            padding: 10px 20px;
            object-fit: contain;
            align-self: center
        }
}


        @media (max-width:768px) {
            .product-meta{
                display: flex;
                flex-direction: column;
                gap: 0px;
            }
        }

                /* Related Products Section */
        .related-products {
            padding: 15px;
            max-width: 1500px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f5f7fa, #e8f0f5); /* Match product detail background */
        }

        .product-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .product-list-header h2 {
            font-family: 'Poppins', sans-serif; /* Use Poppins for headers to match design */
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            color: #222;
        }

        .product-header-controls {
            display: flex;
            flex-direction: row;
            gap: 8px;
            z-index: 8;
        }

        .product-header-control {
            background: #ffca28;
            color: #fff;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
        }

        
        .product-header-control:hover {
            background: #ffb300;
        }

        .product-header-control span.material-symbols-outlined {
            font-size: 1rem;
        }
        
        .product-meta{
            border-bottom: 2px solid #222;
        }

        .product-slider {
            overflow: hidden;
        }

        .product-cards {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding-bottom: 10px; /* For scrollbar visibility */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        .product-cards::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .related-products .product-card {
            background: #fff;
            border-radius: 10px;
            max-width: 250px;
            padding: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 0 0 calc(50% - 5px); /* 2 cards per row on mobile */
        }

        .related-products .product-card:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .image-container {
            width: 100%;
        }

        .related-products .product-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .product-info h3{
            font-size: clamp(1rem, 2vw, 0.95rem);
            height: 55px;
        }

         .related-products .product-price-rating {
            margin-bottom: 10px;
         }

        .related-products .product-price-rating .product-price {
            font-family: 'Poppins', sans-serif;
            color: #222;
            font-weight: 600;
            font-size: clamp(1.3rem, 2vw, 0.95rem);
        }

        .related-products .product-rating {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .related-products .product-rating .stars {
            font-size: clamp(0.85rem, 2vw, 0.95rem);
        }

        .related-products .star.filled {
            color: #ffca28;
        }

        .related-products .star.empty {
            color: #ddd;
        }

        .related-products .rating-count {
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
            color: #555;
        }

        .related-products .product-actions {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            width: 100%;
        }

        .related-products .add-to-cart,
        .related-products .add-to-wishlist {
            gap: 4px;
            border: none;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .related-products .add-to-cart {
            background: #ffca28;
            color: #fff;
            border-radius: 20px;
            width: 100%;
        }

        .related-products .add-to-cart:hover {
            background: #ffb300;
        }

        .related-products .add-to-wishlist {
            background: #f0f0f0;
            color: #ffca28;
            border-radius: 18px;
            width: 50px;
        }

        .related-products .add-to-wishlist:hover,
        .related-products .add-to-wishlist.active {
            background: #ffca28;
            color: #fff;
        }

        .related-products .add-to-cart.added-to-cart.go-to-cart {
            background: #4caf50;
            color: #fff;
        }

        .review-item{
            background-color: #F9F9F9;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 2vh;
        }

        .product-price-rating{
            display: flex;
            flex-direction: row;
            gap: 4vh;
        }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .product-list-header{
                display: flex;
                flex-direction: row;
            }
         
            /* Related Products Adjustments for Desktop */
            .related-products {
                padding: 20px;
            }

            .product-list-header h2 {
                font-size: clamp(1.5rem, 4vw, 2rem);
                margin-bottom: 20px;
            }

            .product-header-control {
                padding: 10px;
                display: flex;
                flex-direction: row;
            }

            .product-header-control span.material-symbols-outlined {
                font-size: 1.2rem;
            }

            .product-cards {
                gap: 15px;
            }

            .related-products .product-card {
                flex: 0 0 calc(25% - 11.25px); /* 4 cards per row on desktop */
            }

            .related-products .product-image {
                height: 250px;
            }

            .related-products .product-name {
                font-size: clamp(0.9rem, 2vw, 1rem);
            }

            .related-products .product-price {
                font-size: clamp(0.9rem, 2vw, 1rem);
            }
            
            .related-products .product-rating .stars {
                font-size: clamp(0.9rem, 2vw, 1rem);
            }

            .related-products .rating-count {
                font-size: clamp(0.8rem, 1.5vw, 0.9rem);
            }

            .related-products .add-to-cart,
            .related-products .add-to-wishlist {
                font-size: clamp(0.8rem, 1.5vw, 0.9rem);
                padding: 8px 16px;
            }
        }

        .mrp {
            font-size: 2em;
             color: gray;
        }

        @media (max-width: 480px) {
            /* Related Products Adjustments for Mobile */
            .related-products {
                padding: 15px;
                margin: 15px 0;
            }

            .related-products h2 {
                font-size: clamp(1.2rem, 4vw, 1.5rem);
            }

            .product-list-header{
                display: flex;
                flex-direction: row;
            }

            .product-header-control {
                padding: 6px;
            }


            .product-actions{
                display: flex;
                flex-direction: row;
            } 

            .cart-txt{
                display: none;
            }

            .product-info h3{
                height: 66px;
            }

            .product-header-control span {
                font-size: 16px;
            }

            .product-price-rating{
                display: flex;
                flex-direction: column;
                gap: 0;
            }

            /* Related Products Adjustments for Mobile (max-width: 767px) */
            .related-products .add-to-cart span.text {
                display: none; /* Hide "Add to Cart" text on mobile */
            }

            .related-products .add-to-cart {
                height: 40px;
                padding: 6px 8px; /* Adjust padding for icon-only button */
            }

            .related-products .add-to-wishlist {
                /* padding: 6px 8px; */
            }
        }

        @media (max-width: 400px) {
            .product-list-header h2 {
                font-size: 0.95rem !important;
            }
            .product-list-header {
                gap: 2px;
            }
            .product-header-controls {
                flex-shrink: 1;
            }
        }
        
        .redeem-points {
            background: #ffca28;
            color: #fff;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            font-weight: 600;
            padding: 14px 32px;
            margin-bottom: 14px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
        }
        .redeem-points:hover {
            background: #ffb300;
            color: #fff;
            box-shadow: 0 4px 16px rgba(255,202,40,0.18);
        }
        .request-swap {
            background: #fff;
            color: #ffca28;
            border: 2px solid #ffca28;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            font-weight: 600;
            padding: 14px 32px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s, border 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .request-swap:hover {
            background: #ffca28;
            color: #fff;
            border: 2px solid #ffb300;
            box-shadow: 0 4px 16px rgba(255,202,40,0.12);
        }
        
        /* Disabled button styles */
        .redeem-points:disabled,
        .request-swap:disabled {
            opacity: 0.6;
            cursor: not-allowed !important;
            pointer-events: none;
        }
        
        .redeem-points:disabled:hover,
        .request-swap:disabled:hover {
            background: inherit;
            color: inherit;
            box-shadow: inherit;
        }
        
        /* Tooltip styles for disabled buttons */
        .redeem-points[title]:hover::after,
        .request-swap[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 8px;
        }
        
        .redeem-points[title]:hover::before,
        .request-swap[title]:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.8);
            margin-bottom: 3px;
        }
        
        .product-action {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 18px;
            align-items: stretch;
            position: relative;
        }
    </style>

</head>
<body>
    {% include 'navbar.html' %}
    <div class="product-detail-section">
        <div class="product-container">
            <div class="product-image">
                <div class="image-nav">
                    <button class="image-nav-btn prev"><span class="material-symbols-outlined">arrow_back_ios</span></button>
                    <button class="image-nav-btn next"><span class="material-symbols-outlined">arrow_forward_ios</span></button>
                </div>
                <div class="main-img">
                <img id="main-product-image" src="{{ product.image_url }}" alt="{{ product.name }}">
                </div>
                <div class="image-gallery">
                    <div class="thumbnail active" data-image-url="{{ product.image_url }}">
                        <img src="{{ product.image_url }}" alt="{{ product.name }}">
                    </div>
                    {% for image in product.additional_images %}
                        <div class="thumbnail" data-image-url="{{ image.image_url }}">
                            <img src="{{ image.image_url }}" alt="{{ product.name }}">
                        </div>
                    {% endfor %}
                </div>
                
            </div>
            <div class="product-right-section">
                <div class="product-info">
                    <h1>{{ product.name }}</h1>
                    <div class="product-meta-flex">
                        <div class="price-container" style="display: flex; align-items: start; justify-content: center; flex-direction: column; gap: 0vh;">
                            <div class="upper" style="display: flex; align-items: center; gap: 2vh;">
                                <p class="mrp">MRP:</p>
                                <p class="product-price"> â‚¹{{ "%.2f"|format(product.price) }}</p>
                            </div>
                            <div class="tax" style="font-size: 0.7em;">
                                *inclusive of all taxes
                            </div>
                        </div>
                        <div class="product-tag" style="align-self: flex-start; border: 1.5px solid #ffca28; border-radius: 8px; padding: 2px 14px; font-weight: 600; color: #ffca28; font-size: 1em; margin-left: 2vw; margin-top: 4px; height: fit-content; display: flex; align-items: center;">Mens</div>
                    </div>
                </div>
               
               <div class="weight-quantity-stock">
                    <!-- Product attributes -->
                    {% if product.attributes %}
                    <div class="product-attributes" style="margin: 15px 0;">
                        <h4>Specifications:</h4>
                        <div class="attributes-list">
                            {% for attr in product.attributes %}
                            <div class="attribute-item" style="margin: 5px 0;">
                                <strong>{{ attr.key }}:</strong> {{ attr.value }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Dynamic product description -->
                <div class="static-product-description">
                  {{ product.description or 'Premium quality clothing item for style-conscious individuals.' }}
                </div>
                
                <div class="static-size">Category: {{ product.category.name }} | Style: {{ product.pet_type.name }}</div>
                
                {% if current_user.is_authenticated %}
                <div class="user-points-display" style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #ffca28;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="material-symbols-outlined" style="color: #ffca28; font-size: 1.2em;">stars</span>
                        <span style="font-weight: 600; color: #333;">Your Balance: {{ current_user.points_balance }} coins</span>
                    </div>
                    {% if current_user.points_balance < product.points_required %}
                    <div style="margin-top: 8px; font-size: 0.9em; color: #dc3545;">
                        <span class="material-symbols-outlined" style="font-size: 0.9em;">warning</span>
                        You need {{ product.points_required - current_user.points_balance }} more coins to redeem this item
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="product-action">
                    <button id="redeem-points-btn" class="redeem-points" data-product-id="{{ product.id }}"
                        {% if current_user.is_authenticated %}
                            data-user-points="{{ current_user.points_balance }}"
                        {% endif %}
                        {% if user_has_redeemed %}
                            data-redeemed="true"
                            disabled
                            style="opacity: 0.6; cursor: not-allowed;"
                        {% elif not current_user.is_authenticated %}
                            onclick="window.location.href='{{ url_for('main.signin', next_action='redeem') }}'"
                        {% elif current_user.is_authenticated and product.uploader_id == current_user.id %}
                            disabled
                            title="You cannot redeem your own product"
                            style="opacity: 0.6; cursor: not-allowed;"
                        {% else %}
                            onclick="redeemWithPoints({{ product.id }}, {{ product.points_required }})"
                        {% endif %}
                    >
                        <span class="material-symbols-outlined">stars</span>
                        {% if user_has_redeemed %}Redeemed{% else %}Redeem for {{ product.points_required }} points{% endif %}
                    </button>
                    <button id="request-swap-btn" class="request-swap" data-product-id="{{ product.id }}"
                        {% if user_has_redeemed %}
                            disabled
                            title="Already redeemed"
                            style="opacity: 0.6; cursor: not-allowed;"
                        {% elif not current_user.is_authenticated %}
                            onclick="window.location.href='{{ url_for('main.signin', next_action='swap') }}'"
                        {% elif current_user.is_authenticated and product.uploader_id == current_user.id %}
                            disabled
                            title="You cannot swap your own product"
                            style="opacity: 0.6; cursor: not-allowed;"
                        {% else %}
                            onclick="openSwapModal()"
                        {% endif %}
                    >
                        <span class="material-symbols-outlined">swap_horiz</span>
                        Request Swap
                    </button>
                </div>
                
                <div class="product-meta-extra" style="margin-top: 18px; font-size: 1.05em; line-height: 1.7; color: #333;">
                    {% if product.uploader %}
                    <div><strong>Listed by:</strong> {{ product.uploader.username }} 
                        {% if product.uploader.swaps_as_user1|length + product.uploader.swaps_as_user2|length > 0 %}
                        ({{ product.uploader.swaps_as_user1|length + product.uploader.swaps_as_user2|length }} swaps)
                        {% endif %}
                    </div>
                    {% endif %}
                    <div><strong>Listed:</strong> {{ product.created_at.strftime('%B %d, %Y') }}</div>
                </div>
            </div>
        </div>
    </div>
    <!-- Swap Modal -->
<div id="swapModal" class="swap-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); z-index:1000; align-items:center; justify-content:center;">
  <div class="swap-modal-content" style="background:#fff; border-radius:12px; max-width:500px; width:90vw; max-height:80vh; overflow:auto; padding:24px; position:relative;">
    <button id="closeSwapModal" style="position:absolute; top:12px; right:12px; background:none; border:none; font-size:1.5em; cursor:pointer;">&times;</button>
    <h2 style="margin-bottom:18px;">Select an item to swap</h2>
    <div id="userItemsGrid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:16px; max-height:45vh; overflow-y:auto; margin-bottom:18px;">
      {% if user_uploaded_products and user_uploaded_products|length > 0 %}
        {% for item in user_uploaded_products %}
          <div class="swap-item-card" data-item-id="{{ item.id }}" style="border: 1.5px solid #eee; border-radius: 8px; padding: 8px; display: flex; flex-direction: column; align-items: center; background: #fafafa;">
            <img src="{{ item.image_url }}" alt="{{ item.name }}" style="width:80px;height:80px;object-fit:cover;border-radius:6px;margin-bottom:8px;">
            <div style="font-weight:500;font-size:1em;margin-bottom:8px;text-align:center;">{{ item.name }}</div>
            <button class="select-swap-item-btn" style="background:#ffca28;color:#fff;border:none;padding:6px 16px;border-radius:6px;cursor:pointer;font-weight:600;">Select</button>
          </div>
        {% endfor %}
      {% else %}
        <div style="grid-column:1/-1;text-align:center;">No items found. <a href="/upload">Upload an item</a></div>
      {% endif %}
    </div>
    <button id="confirmSwapBtn" class="request-swap" style="width:100%; margin-top:10px; display:none;">Confirm Swap</button>
  </div>
</div>
    <div class="related-products">
        <div class="product-list-header">
            <h2>You May Also Like</h2>
            <div class="product-header-controls">
                <button class="product-header-control prev"><span class="material-symbols-outlined">arrow_back_ios</span></button>
                <button class="product-header-control next"><span class="material-symbols-outlined">arrow_forward_ios</span></button>
            </div>
        </div>
        <div class="product-slider">
            <div class="product-cards" id="recommended-products">
                {% if recommended_products %}
                    {% for product in recommended_products %}
                        <div class="product-card" data-product-id="{{ product.id }}">
                            <div class="wishlist-button-top">
                                <button class="add-to-wishlist" data-product-id="{{ product.id }}">
                                    <span class="material-symbols-outlined">favorite</span>
                                </button>
                            </div>
                            <img class="product-image" src="{{ product.image_url or '/static/images/default-product.jpg' }}" alt="{{ product.name }}">
                            <h3 class="product-name">{{ product.name }}</h3>
                            <div class="product-price-rating">
                                <span class="product-price"><img src="{{ url_for('static', filename='images/coin.png') }}" class="coin-icon">{{ product.points_required or '0' }}</span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="no-products" style="text-align: center; padding: 40px; color: #666;">
                        <p>No related products found</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- Customer review section and all related HTML, CSS, and JS have been removed as requested. -->
    {% include 'footer.html' %}
      <nav class="mobile-bottom-nav">
        <a href="{{ url_for('main.home') }}" class="{% if request.endpoint == 'main.home' %}active{% endif %}">
            <span class="material-symbols-outlined">home</span>
            <span>Home</span>
        </a>
        <a href="{{ url_for('main.search') }}" class="{% if request.endpoint == 'main.search' %}active{% endif %}">
            <span class="material-symbols-outlined">search</span>
            <span>Search</span>
        </a>
        <a href="{{ url_for('main.wishlist') }}" class="{% if request.endpoint == 'main.wishlist' %}active{% endif %}">
            <span class="material-symbols-outlined">favorite</span>
            <span>Wishlist</span>
        </a>
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('main.profile') }}" class="{% if request.endpoint == 'main.profile' %}active{% endif %}">
                <span class="material-symbols-outlined">person</span>
                <span>Profile</span>
            </a>
        {% else %}
            <a href="{{ url_for('main.signin') }}" class="{% if request.endpoint == 'main.signin' %}active{% endif %}">
                <span class="material-symbols-outlined">login</span>
                <span>Login</span>
            </a>
        {% endif %}
    </nav>
    <script src="{{ url_for('static', filename='js/product-detail.js') }}"></script>
    <script>
function openSwapModal() {
  document.getElementById('swapModal').style.display = 'flex';
  // No need to fetch, items are rendered server-side
}
document.getElementById('closeSwapModal').onclick = function() {
  document.getElementById('swapModal').style.display = 'none';
}

let selectedSwapItemId = null;
const grid = document.getElementById('userItemsGrid');
Array.from(grid.querySelectorAll('.swap-item-card')).forEach(card => {
  card.querySelector('.select-swap-item-btn').onclick = function() {
    selectedSwapItemId = card.getAttribute('data-item-id');
    Array.from(grid.children).forEach(c => c.style.border = '1.5px solid #eee');
    card.style.border = '2.5px solid #ffca28';
    document.getElementById('confirmSwapBtn').style.display = 'block';
  };
});

document.getElementById('confirmSwapBtn').onclick = function() {
  if (!selectedSwapItemId) return;
  
  // Get CSRF token from meta tag
  const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
  
  fetch('/create-swap-request', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': csrfToken
    },
    body: JSON.stringify({
      requested_item_id: {{ product.id }},
      offered_item_id: selectedSwapItemId
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      showNotification(data.message || 'Swap request sent successfully!', 'success');
      document.getElementById('swapModal').style.display = 'none';
      // Optionally redirect to profile page after a delay
      setTimeout(() => window.location.href = '/profile', 1500);
    } else {
      showNotification(data.message || 'Failed to send swap request', 'error');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    showNotification('An error occurred while sending swap request', 'error');
  });
};
</script>
</body>
</html>

