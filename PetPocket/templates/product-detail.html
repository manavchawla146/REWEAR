<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{{ product.name }} - ReWear</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/product-detail.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/product-detail-related.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/product-detail-review.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Open+Sans:wght@400&display=swap" rel="stylesheet">
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
    rel="stylesheet"
/>
    <style>

        .product-info h1{
            font-weight: 500;
        }

         .product-meta {
            display: flex;
            align-items: center;
            gap: 10vh;
            margin-bottom: 15px;
        }

        .product-price{
            font-size: clamp(2.1rem, 2vw, 0.95rem);
            color: #ffca28;
        }

        .info {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2vh;
            margin-bottom: 4vh;
            
        }

        .delivery {
            border: 1px solid #ffca28;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.053);
            background: linear-gradient(145deg, #fff7e6, #fff); 
            gap: 1vh;
        }

        .delivery i {
           font-size: 24px;
            width: 35px;
            height: 35px;
            padding: 12px;
            background: linear-gradient(90deg, #ffca28, #ffb300);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delivery p {
            font-weight: 900;
        }


        .satisfaction {
            border: 1px solid #ffca28;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.053);
            background: linear-gradient(145deg, #fff7e6, #fff);
            gap: 1vh; 
        }

        .satisfaction i {
           font-size: 24px;
            width: 35px;
            height: 35px;
            padding: 12px;
            background: linear-gradient(90deg, #ffca28, #ffb300);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .satisfaction p {
            font-weight: 900;
        }


         .safe-payment {
            border: 1px solid #ffca28;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.053);
            background: linear-gradient(145deg, #fff7e6, #fff); 
            gap: 1vh;
        }

        .safe-payment i {
            font-size: 24px;
            width: 35px;
            height: 35px;
            padding: 12px;
            background: linear-gradient(90deg, #ffca28, #ffb300);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .safe-payment p {
            font-weight: 900;
        }

/*         
        .product-container {
    flex-direction: row;
    gap: 30px;
    padding: 30px;
    align-items: flex-start; 
    
} */

.product-image {
    flex: 1;
    order: 1;
    text-align: left;
    position: sticky;
    top: 20px; /* Stick to the top with a small offset */
    align-self: flex-start; /* Ensure it starts at the top */
    z-index: 10;
}



@media (max-width: 480px) {

            .info {
                gap: 10px;
                padding: 10px;
                display: flex;
                flex-wrap: wrap;
                flex: 1;
            }

            .delivery,
            .satisfaction,
            .safe-payment {
                flex: 1; /* Even smaller card width */
                padding: 12px;
                height: 100px;
            }

            .delivery i,
            .satisfaction i,
            .safe-payment i {
                font-size: 18px;
                width: 35px;
                height: 35px;
                padding: 8px;
            }

            .delivery p,
            .satisfaction p,
            .safe-payment p {
                font-size: 10px;
            }
        

    
        .product-image {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
            justify-content: center;
            overflow: hidden;
            padding: 10px 20px;
            object-fit: contain;
            align-self: center
        }
}


        @media (max-width:768px) {
            .product-meta{
                display: flex;
                flex-direction: column;
                gap: 0px;
            }
        }

                /* Related Products Section */
        .related-products {
            padding: 15px;
            max-width: 1500px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f5f7fa, #e8f0f5); /* Match product detail background */
        }

        .product-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .product-list-header h2 {
            font-family: 'Poppins', sans-serif; /* Use Poppins for headers to match design */
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            color: #222;
        }

        .product-header-controls {
            display: flex;
            flex-direction: row;
            gap: 8px;
            z-index: 8;
        }

        .product-header-control {
            background: #ffca28;
            color: #fff;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
        }

        
        .product-header-control:hover {
            background: #ffb300;
        }

        .product-header-control span.material-symbols-outlined {
            font-size: 1rem;
        }
        
        .product-meta{
            border-bottom: 2px solid #222;
        }

        .product-slider {
            overflow: hidden;
        }

        .product-cards {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding-bottom: 10px; /* For scrollbar visibility */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        .product-cards::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .related-products .product-card {
            background: #fff;
            border-radius: 10px;
            max-width: 250px;
            padding: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 0 0 calc(50% - 5px); /* 2 cards per row on mobile */
        }

        .related-products .product-card:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .image-container {
            width: 100%;
        }

        .related-products .product-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .product-info h3{
            font-size: clamp(1rem, 2vw, 0.95rem);
            height: 55px;
        }

         .related-products .product-price-rating {
            margin-bottom: 10px;
         }

        .related-products .product-price-rating .product-price {
            font-family: 'Poppins', sans-serif;
            color: #222;
            font-weight: 600;
            font-size: clamp(1.3rem, 2vw, 0.95rem);
        }

        .related-products .product-rating {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .related-products .product-rating .stars {
            font-size: clamp(0.85rem, 2vw, 0.95rem);
        }

        .related-products .star.filled {
            color: #ffca28;
        }

        .related-products .star.empty {
            color: #ddd;
        }

        .related-products .rating-count {
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
            color: #555;
        }

        .related-products .product-actions {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            width: 100%;
        }

        .related-products .add-to-cart,
        .related-products .add-to-wishlist {
            gap: 4px;
            border: none;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .related-products .add-to-cart {
            background: #ffca28;
            color: #fff;
            border-radius: 20px;
            width: 100%;
        }

        .related-products .add-to-cart:hover {
            background: #ffb300;
        }

        .related-products .add-to-wishlist {
            background: #f0f0f0;
            color: #ffca28;
            border-radius: 18px;
            width: 50px;
        }

        .related-products .add-to-wishlist:hover,
        .related-products .add-to-wishlist.active {
            background: #ffca28;
            color: #fff;
        }

        .related-products .add-to-cart.added-to-cart.go-to-cart {
            background: #4caf50;
            color: #fff;
        }

        .review-item{
            background-color: #F9F9F9;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 2vh;
        }

        .product-price-rating{
            display: flex;
            flex-direction: row;
            gap: 4vh;
        }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .product-list-header{
                display: flex;
                flex-direction: row;
            }
         
            /* Related Products Adjustments for Desktop */
            .related-products {
                padding: 20px;
            }

            .product-list-header h2 {
                font-size: clamp(1.5rem, 4vw, 2rem);
                margin-bottom: 20px;
            }

            .product-header-control {
                padding: 10px;
                display: flex;
                flex-direction: row;
            }

            .product-header-control span.material-symbols-outlined {
                font-size: 1.2rem;
            }

            .product-cards {
                gap: 15px;
            }

            .related-products .product-card {
                flex: 0 0 calc(25% - 11.25px); /* 4 cards per row on desktop */
            }

            .related-products .product-image {
                height: 250px;
            }

            .related-products .product-name {
                font-size: clamp(0.9rem, 2vw, 1rem);
            }

            .related-products .product-price {
                font-size: clamp(0.9rem, 2vw, 1rem);
            }
            
            .related-products .product-rating .stars {
                font-size: clamp(0.9rem, 2vw, 1rem);
            }

            .related-products .rating-count {
                font-size: clamp(0.8rem, 1.5vw, 0.9rem);
            }

            .related-products .add-to-cart,
            .related-products .add-to-wishlist {
                font-size: clamp(0.8rem, 1.5vw, 0.9rem);
                padding: 8px 16px;
            }
        }

        .mrp {
            font-size: 2em;
             color: gray;
        }

        @media (max-width: 480px) {
            /* Related Products Adjustments for Mobile */
            .related-products {
                padding: 15px;
                margin: 15px 0;
            }

            .related-products h2 {
                font-size: clamp(1.2rem, 4vw, 1.5rem);
            }

            .product-list-header{
                display: flex;
                flex-direction: row;
            }

            .product-header-control {
                padding: 6px;
            }


            .product-actions{
                display: flex;
                flex-direction: row;
            } 

            .cart-txt{
                display: none;
            }

            .product-info h3{
                height: 66px;
            }

            .product-header-control span {
                font-size: 16px;
            }

            .product-price-rating{
                display: flex;
                flex-direction: column;
                gap: 0;
            }

            /* Related Products Adjustments for Mobile (max-width: 767px) */
            .related-products .add-to-cart span.text {
                display: none; /* Hide "Add to Cart" text on mobile */
            }

            .related-products .add-to-cart {
                height: 40px;
                padding: 6px 8px; /* Adjust padding for icon-only button */
            }

            .related-products .add-to-wishlist {
                /* padding: 6px 8px; */
            }
        }

        @media (max-width: 400px) {
            .product-list-header h2 {
                font-size: 0.95rem !important;
            }
            .product-list-header {
                gap: 2px;
            }
            .product-header-controls {
                flex-shrink: 1;
            }
        }
        
        .redeem-points {
            background: #ffca28;
            color: #fff;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            font-weight: 600;
            padding: 14px 32px;
            margin-bottom: 14px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
        }
        .redeem-points:hover {
            background: #ffb300;
            color: #fff;
            box-shadow: 0 4px 16px rgba(255,202,40,0.18);
        }
        .request-swap {
            background: #fff;
            color: #ffca28;
            border: 2px solid #ffca28;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            font-weight: 600;
            padding: 14px 32px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s, border 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .request-swap:hover {
            background: #ffca28;
            color: #fff;
            border: 2px solid #ffb300;
            box-shadow: 0 4px 16px rgba(255,202,40,0.12);
        }
        .product-action {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 18px;
            align-items: stretch;
        }
    </style>

</head>
<body>
    {% include 'navbar.html' %}
    <div class="product-detail-section">
        <div class="product-container">
            <div class="product-image">
                <div class="image-nav">
                    <button class="image-nav-btn prev"><span class="material-symbols-outlined">arrow_back_ios</span></button>
                    <button class="image-nav-btn next"><span class="material-symbols-outlined">arrow_forward_ios</span></button>
                </div>
                <div class="main-img">
                <img id="main-product-image" src="{{ product.image_url }}" alt="{{ product.name }}">
                </div>
                <div class="image-gallery">
                    <div class="thumbnail active" data-image-url="{{ product.image_url }}">
                        <img src="{{ product.image_url }}" alt="{{ product.name }}">
                    </div>
                    {% for image in product.additional_images %}
                        <div class="thumbnail" data-image-url="{{ image.image_url }}">
                            <img src="{{ image.image_url }}" alt="{{ product.name }}">
                        </div>
                    {% endfor %}
                </div>
                
            </div>
            <div class="product-right-section">
                <div class="product-info">
                    <h1>{{ product.name }}</h1>
                    <div class="product-meta-flex">
                        <div class="price-container" style="display: flex; align-items: start; justify-content: center; flex-direction: column; gap: 0vh;">
                            <div class="upper" style="display: flex; align-items: center; gap: 2vh;">
                                {% if product.points_required %}
                                <p class="mrp">Gold</p>
                                <p class="product-price">{{ product.points_required }} points</p>
                                {% else %}
                                <p class="mrp">Available for:</p>
                                <p class="product-price">Swap Only</p>
                                {% endif %}
                            </div>
                            <div class="tax" style="font-size: 0.7em;">
                                *Exchange through points or swaps only
                            </div>
                        </div>
                        <div class="product-tag" style="align-self: flex-start; border: 1.5px solid #ffca28; border-radius: 8px; padding: 2px 14px; font-weight: 600; color: #ffca28; font-size: 1em; margin-left: 2vw; margin-top: 4px; height: fit-content; display: flex; align-items: center;">{{ product.category.name }}</div>
                    </div>
                </div>
               
               <div class="weight-quantity-stock">
                    <!-- Stock information -->
                    <div class="stock-info" style="margin: 15px 0;">
                        {% if product.stock > 0 %}
                            <span class="in-stock" style="color: #4caf50; font-weight: 600;">
                                <span class="material-symbols-outlined">check_circle</span>
                                {{ product.stock }} items in stock
                            </span>
                        {% else %}
                            <span class="out-of-stock" style="color: #f44336; font-weight: 600;">
                                <span class="material-symbols-outlined">cancel</span>
                                Out of stock
                            </span>
                        {% endif %}
                    </div>

                    <!-- Product attributes -->
                    {% if product.attributes %}
                    <div class="product-attributes" style="margin: 15px 0;">
                        <h4>Specifications:</h4>
                        <div class="attributes-list">
                            {% for attr in product.attributes %}
                            <div class="attribute-item" style="margin: 5px 0;">
                                <strong>{{ attr.key }}:</strong> {{ attr.value }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Dynamic product description -->
                <div class="static-product-description">
                  {{ product.description or 'Premium quality clothing item for style-conscious individuals.' }}
                </div>
                
                <div class="static-size">Category: {{ product.category.name }} | Style: {{ product.pet_type.name }}</div>
                
                <div class="product-action">
                    {% if current_user.is_authenticated %}
                        {% if product.points_required and current_user.points_balance >= product.points_required and product.stock > 0 %}
                        <button id="redeem-points-btn" class="redeem-points" data-product-id="{{ product.id }}" onclick="redeemWithPoints({{ product.id }}, {{ product.points_required }})">
                            <span class="material-symbols-outlined">stars</span>
                            Redeem for {{ product.points_required }} points
                        </button>
                        {% elif product.points_required and current_user.points_balance < product.points_required %}
                        <button class="redeem-points" disabled style="opacity: 0.6; cursor: not-allowed;">
                            <span class="material-symbols-outlined">stars</span>
                            Need {{ product.points_required - current_user.points_balance }} more points
                        </button>
                        {% endif %}
                        
                        {% if product.stock > 0 %}
                        <button id="request-swap-btn" class="request-swap" data-product-id="{{ product.id }}" onclick="requestSwap({{ product.id }})">
                            <span class="material-symbols-outlined">swap_horiz</span>
                            Request Swap
                        </button>
                        {% endif %}
                    {% else %}
                        <p style="text-align: center; padding: 20px; color: #666;">
                            <a href="{{ url_for('main.signin') }}" style="color: #ffca28; text-decoration: none; font-weight: 600;">Login</a> to redeem points or request swaps
                        </p>
                    {% endif %}
                </div>
                
                <div class="product-meta-extra" style="margin-top: 18px; font-size: 1.05em; line-height: 1.7; color: #333;">
                    {% if product.uploader %}
                    <div><strong>Listed by:</strong> {{ product.uploader.username }} 
                        {% if product.uploader.swaps_as_user1|length + product.uploader.swaps_as_user2|length > 0 %}
                        ({{ product.uploader.swaps_as_user1|length + product.uploader.swaps_as_user2|length }} swaps)
                        {% endif %}
                    </div>
                    {% endif %}
                    <div><strong>Status:</strong> 
                        {% if product.stock > 0 %}
                        <span style="color: #4caf50;">✅ Available</span>
                        {% else %}
                        <span style="color: #f44336;">❌ Out of Stock</span>
                        {% endif %}
                    </div>
                    <div><strong>Listed:</strong> {{ product.created_at.strftime('%B %d, %Y') }}</div>
                    {% if product.reviews|length > 0 %}
                    <div><strong>Rating:</strong> 
                        {% set avg_rating = (product.reviews | sum(attribute='rating')) / (product.reviews | length) %}
                        <span style="color: #ffca28;">{{ "%.1f"|format(avg_rating) }}/5</span> 
                        ({{ product.reviews|length }} reviews)
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="related-products">
        <div class="product-list-header">
            <h2>You May Also Like</h2>
            <div class="product-header-controls">
                <button class="product-header-control prev"><span class="material-symbols-outlined">arrow_back_ios</span></button>
                <button class="product-header-control next"><span class="material-symbols-outlined">arrow_forward_ios</span></button>
            </div>
        </div>
        <div class="product-slider">
            <div class="product-cards" id="recommended-products">
                {% if recommended_products %}
                    {% for product in recommended_products %}
                        <div class="product-card" data-product-id="{{ product.id }}">
                            <div class="image-container">
                                <img src="{{ product.image_url or '/static/images/default-product.jpg' }}" alt="{{ product.name }}">
                            </div>
                            <div class="product-info">
                                <h3>{{ product.name }}</h3>
                                {% if product.points_required %}
                                <p class="points-badge">{{ product.points_required }} points</p>
                                {% endif %}
                            </div>
                            <div class="product-price-rating">
                                {% if product.points_required %}
                                <p class="product-price">{{ product.points_required }} points</p>
                                {% else %}
                                <p class="product-price">Swap Only</p>
                                {% endif %}
                                {% if product.reviews|length > 0 %}
                                    {% set avg_rating = (product.reviews | sum(attribute='rating')) / (product.reviews | length) %}
                                    <div class="rating">
                                        <span class="material-symbols-outlined star">star</span>
                                        <span>{{ "%.1f"|format(avg_rating) }}</span>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="product-actions">
                                {% if current_user.is_authenticated %}
                                    {% if product.points_required and current_user.points_balance >= product.points_required %}
                                    <button class="redeem-points" data-product-id="{{ product.id }}">
                                        <span class="material-symbols-outlined">stars</span> <p class="cart-txt">Redeem</p>
                                    </button>
                                    {% else %}
                                    <button class="request-swap" data-product-id="{{ product.id }}">
                                        <span class="material-symbols-outlined">swap_horiz</span> <p class="cart-txt">Swap</p>
                                    </button>
                                    {% endif %}
                                    <button class="add-to-wishlist" data-product-id="{{ product.id }}">
                                        <span class="material-symbols-outlined">favorite</span>
                                    </button>
                                {% else %}
                                    <a href="{{ url_for('main.signin') }}" class="login-to-action">
                                        <span class="material-symbols-outlined">login</span> <p class="cart-txt">Login</p>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="no-products" style="text-align: center; padding: 40px; color: #666;">
                        <p>No related products found</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- Customer review section and all related HTML, CSS, and JS have been removed as requested. -->
    {% include 'footer.html' %}
      <nav class="mobile-bottom-nav">
        <a href="{{ url_for('main.home') }}" class="{% if request.endpoint == 'main.home' %}active{% endif %}">
            <span class="material-symbols-outlined">home</span>
            <span>Home</span>
        </a>
        <a href="{{ url_for('main.search') }}" class="{% if request.endpoint == 'main.search' %}active{% endif %}">
            <span class="material-symbols-outlined">search</span>
            <span>Search</span>
        </a>
        <a href="{{ url_for('main.wishlist') }}" class="{% if request.endpoint == 'main.wishlist' %}active{% endif %}">
            <span class="material-symbols-outlined">favorite</span>
            <span>Wishlist</span>
        </a>
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('main.profile') }}" class="{% if request.endpoint == 'main.profile' %}active{% endif %}">
                <span class="material-symbols-outlined">person</span>
                <span>Profile</span>
            </a>
        {% else %}
            <a href="{{ url_for('main.signin') }}" class="{% if request.endpoint == 'main.signin' %}active{% endif %}">
                <span class="material-symbols-outlined">login</span>
                <span>Login</span>
            </a>
        {% endif %}
    </nav>
    <script src="{{ url_for('static', filename='js/product-detail.js') }}"></script>
</body>
</html>

